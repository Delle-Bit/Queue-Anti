<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Clinic Queue</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <!-- Firebase SDKs -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>

<body>

    <div class="container">
        <h1>JEA Medical Clinic</h1>
        <div id="offline-message" style="display:none; color: red;">Clinic is currently CLOSED.</div>

        <div id="join-queue-section" class="category-list">
            <p>Welcome! Please select your category to join the queue:</p>

            <div class="category-card" onclick="joinQueue('Q')">
                <div class="card-icon">ðŸ‘¤</div>
                <div class="card-info">
                    <h3>Regular Patient</h3>
                    <p>General checkups and consultations</p>
                </div>
            </div>

            <div class="category-card priority" onclick="joinQueue('E')">
                <div class="card-icon">ðŸ‘´</div>
                <div class="card-info">
                    <h3>Elderly</h3>
                    <p>Priority for senior citizens</p>
                </div>
            </div>

            <div class="category-card priority" onclick="joinQueue('D')">
                <div class="card-icon">â™¿</div>
                <div class="card-info">
                    <h3>PWD</h3>
                    <p>Priority for persons with disabilities</p>
                </div>
            </div>

            <div class="category-card priority" onclick="joinQueue('P')">
                <div class="card-icon">ðŸ¤°</div>
                <div class="card-info">
                    <h3>Pregnant</h3>
                    <p>Priority for expecting mothers</p>
                </div>
            </div>
        </div>

        <div id="queue-status-section" style="display:none;">
            <div class="queue-status">
                <h2>Now Serving:</h2>
                <div id="current-serving-number" class="current-number">--</div>
                <p id="your-number-display" class="your-number">Your Number: <strong>--</strong></p>
                <p id="wait-time-estimation">Est. Wait Time: <span id="wait-time">--</span> mins</p>
            </div>
            <button class="btn btn-danger" onclick="leaveQueue()">Leave Queue</button>
        </div>

    </div>

    <!-- Floating Chatbot -->
    <button class="chatbot-toggler" onclick="document.body.classList.toggle('show-chatbot')">
        <span class="material-symbols-rounded">ðŸ’¬</span>
        <span class="material-symbols-rounded">close</span>
    </button>
    <div class="chatbot-container">
        <header>
            <h3> <img src="robot.png" alt="Robot" class="icon">
                Clinic Assistant</h3>
            <span class="close-btn material-symbols-rounded"
                onclick="document.body.classList.remove('show-chatbot')">close</span>
        </header>
        <ul id="chat-log">
            <li class="chat incoming">
                <p>Hi there ðŸ‘‹<br>How can I help you today?</p>
            </li>
        </ul>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ask a question..." required>
            <button id="send-btn" class="material-symbols-rounded" onclick="sendMessage()">send</button>
        </div>
    </div>


    <!-- Announcement Modal -->
    <div id="announcement-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 style="color: red;">ðŸ“¢ Announcement</h2>
            <p id="announcement-text">...</p>
        </div>
    </div>

    <script type="module" src="patient.js"></script>
    <script>
        // Global scope helpers for onclick handlers which can be tricky with modules
        window.joinQueue = (type) => window.patientApp.joinQueue(type);
        window.leaveQueue = () => window.patientApp.leaveQueue();
        window.sendMessage = () => window.patientApp.sendMessage();
        window.closeModal = () => document.getElementById('announcement-modal').style.display = "none";
    </script>
</body>

</html>